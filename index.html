<canvas id="jstron" width="640" height="480"></canvas>

<script>
document.addEventListener("keydown", KeyDown, false);

var STAGEWIDTH = 64; //units blocksize
var STAGEHEIGHT = 48; //units blocksize
var BLOCKSIZE = 10; //px
var STAGECOLOR = "#660000";
var hasEscaped = "false";
var PLAYER1COLOR = "#006600";
var PLAYER2COLOR = "#000066";
var MAINTIMEOUT = "500";

var c = document.getElementById("jstron");
var ctx = c.getContext("2d");

var stageArray = new Array(STAGEWIDTH);
for (var i = 0; i < STAGEWIDTH; i++) {
  stageArray[i] = new Array(STAGEHEIGHT);
}

//Temperary Variables
var currentPlayer1;
var currentPlayer2;
var currentStage;

var player1 = function() {
  this.x = 0;
  this.y = 0;
  this.direction = "";

  this.TurnLeft = function() {
    if (this.direction == "north") {
      this.direction = "west";
    }
    if (this.direction == "south") {
      this.direction = "east";
    }
    if (this.direction == "west") {
      this.direction = "south";
    }
    if (this.direction == "east") {
      this.direction = "north";
    }
  }

  this.TurnRight = function() {
    if (this.direction == "north") {
      this.direction = "east";
    }
    if (this.direction == "south") {
      this.direction = "west";
    }
    if (this.direction == "west") {
      this.direction = "north";
    }
    if (this.direction == "east") {
      this.direction = "south";
    }
  }
}

var player2 = function() {
  this.x = 0;
  this.y = 0;
  this.direction = "";

  this.TurnLeft = function() {
    if (this.direction == "north") {
      this.direction = "west";
    }
    if (this.direction == "south") {
      this.direction = "east";
    }
    if (this.direction == "west") {
      this.direction = "south";
    }
    if (this.direction = "east") {
      this.direction = "north";
    }
  }

  this.TurnRight = function() {
    if (this.direction == "north") {
      this.direction = "east";
    }
    if (this.direction == "south") {
      this.direction = "west";
    }
    if (this.direction == "west") {
      this.direction = "north";
    }
    if (this.direction == "east") {
      this.direction = "south";
    }
  }
}

//ctx.fillStyle = "any color";

function InitStage() {
  for (var i = 0; i < STAGEWIDTH; i++) {
    for(var y = 0; y < STAGEHEIGHT; y++) {
      stageArray[i][y] = new Array(2);
      stageArray[i][y] = [STAGECOLOR, ""];
    }
  }
}

function DrawStage() {
  for (var i = 0; i < STAGEWIDTH; i++) {
    for (var y = 0; y < STAGEHEIGHT; y++) {
      ctx.fillStyle = stageArray[i][y][0];
      ctx.fillRect(i*BLOCKSIZE, y*BLOCKSIZE, BLOCKSIZE, BLOCKSIZE);
    }
  }
}

function KeyDown(e) {
  //P key
  if (e.keyCode == 80) {
    hasEscaped = "true";
  }
}

InitStage();
DrawStage();

//Player Starting Positions
player1.y = 23;
player1.x = 0;
player2.y = 23;
player2.x = 63;

stageArray[player1.x][player1.y][0] = [PLAYER1COLOR];
stageArray[player1.x][player1.y][1] = "p1";

stageArray[player2.x][player2.y][0] = [PLAYER2COLOR];
stageArray[player2.x][player2.y][1] = "p2";

DrawStage();

function Player1AI(stage, me, enemyPosition) {
  //me.direction = "east";

  return me;
}

function Player2AI(stage, me, enemyPosition) {
  //me.direction = "west";

  return me;
}

alert("Ready to start?");

var x = 0;

//Just setting a inital direction so you can see them move lol
player1.direction = "east";
player2.direction = "west";

MainLoop = function() {
  c.width = c.width;

  currentStage = stageArray;
  currentPlayer1 = player1;
  currentPlayer2 = player2;

  player1.direction = Player1AI(currentStage, currentPlayer1, [currentPlayer2.x, currentPlayer2.y]).direction;
  player2.direction = Player2AI(currentStage, currentPlayer2, [currentPlayer1.x, currentPlayer1.y]).direction;

  //Player 1 shit
  if (player1.direction == "north") {
    player1.y = player1.y - 1;
  }
  if (player1.direction == "south") {
    player1.y = player1.y + 1;
  }
  if (player1.direction == "west") {
    player1.x = player1.x - 1;
  }
  if (player1.direction == "east") {
    player1.x = player1.x + 1;
  }

  //Player 2 shit
  if (player2.direction == "north") {
    player2.y = player2.y - 1;
  }
  if (player2.direction == "south") {
    player2.y = player2.y + 1;
  }
  if (player2.direction == "west") {
    player2.x = player2.x - 1;
  }
  if (player2.direction == "east") {
    player2.x = player2.x + 1;
  }

  //Actually places the players
  stageArray[player1.x][player1.y][0] = PLAYER1COLOR;
  stageArray[player1.x][player1.y][1] = "p1";

  stageArray[player2.x][player2.y][0] = PLAYER2COLOR;
  stageArray[player2.x][player2.y][1] = "p2";

  DrawStage();
  //alert(x);
  x = x + 1;

  if (hasEscaped == "true") {
    window.clearInterval(MainLoop);
  }
}

window.setInterval(MainLoop, MAINTIMEOUT);

//while (hasEscaped = "false") {
 /// MainLoop();
//}

//MainLoop();
//if (hasEscaped == "false") {
//  setTimeout(MainLoop, MAINTIMEOUT);
//}
</script>
